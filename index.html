<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cat Game</title>
    <style>
        canvas {
            background: #f0f0f0;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="400"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // ตัวแปรสำหรับเกม
        let cat = {
            x: 50,
            y: canvas.height / 2 - 25,
            width: 50,
            height: 50,
            draw: function () {
                ctx.fillStyle = 'orange';
                ctx.fillRect(this.x, this.y, this.width, this.height);
            },
            update: function () {
                // เพิ่มการเคลื่อนที่ได้ที่นี่
            }
        };

        let bullets = [];
        let monsters = [];
        let lives = 3;
        let gameOver = false;
        let monstersShot = 0;

        // ฟังก์ชันยิงกระสุน
        function shoot() {
            let bullet = {
                x: cat.x + cat.width,
                y: cat.y + 20,
                width: 10,
                height: 5,
                speed: 5,
                draw: function () {
                    ctx.fillStyle = 'black';
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                }
            };
            bullets.push(bullet);
        }

        // ฟังก์ชันสร้างมอนสเตอร์
        function createMonster() {
            let monster = {
                x: canvas.width,
                y: Math.random() * (canvas.height - 50),
                width: 50,
                height: 50,
                speed: 2,
                draw: function () {
                    ctx.fillStyle = 'red';
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                }
            };
            monsters.push(monster);
        }

        // เพิ่มไอเทมพิเศษ
        let specialItems = [];
        function createSpecialItem() {
            let specialItem = {
                x: canvas.width,
                y: Math.random() * (canvas.height - 50),
                width: 30,
                height: 30,
                type: Math.random() > 0.5 ? 'autoShoot' : 'poison', // ประเภท: กระสุนอัตโนมัติหรือพิษ
                draw: function () {
                    ctx.fillStyle = this.type === 'autoShoot' ? 'green' : 'purple';
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                }
            };
            specialItems.push(specialItem);
        }

        // ตัวแปรสำหรับสถานะกระสุนอัตโนมัติ
        let autoShootActive = false;
        let autoShootTimeout;

        // ฟังก์ชันเปิดใช้งานกระสุนอัตโนมัติ
        function activateAutoShoot() {
            autoShootActive = true;
            autoShootTimeout = setTimeout(() => {
                autoShootActive = false;
            }, 10000); // เปิดใช้งาน 10 วินาที
        }

        // ฟังก์ชันอัพเดตเกม
        function updateGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // อัปเดตและวาดแมว
            cat.update();
            cat.draw();

            // วาดกระสุนและเคลื่อนที่
            bullets.forEach((bullet, index) => {
                bullet.x += bullet.speed;
                bullet.draw();
                if (bullet.x > canvas.width) {
                    bullets.splice(index, 1);
                }
            });

            // วาดและเคลื่อนที่มอนสเตอร์
            monsters.forEach((monster, index) => {
                monster.x -= monster.speed;
                monster.draw();

                // ตรวจจับการชนระหว่างกระสุนและมอนสเตอร์
                bullets.forEach((bullet, bulletIndex) => {
                    if (bullet.x < monster.x + monster.width &&
                        bullet.x + bullet.width > monster.x &&
                        bullet.y < monster.y + monster.height &&
                        bullet.y + bullet.height > monster.y) {
                        monsters.splice(index, 1);
                        bullets.splice(bulletIndex, 1);
                        monstersShot++;
                    }
                });

                // ตรวจจับการชนระหว่างแมวและมอนสเตอร์
                if (cat.x < monster.x + monster.width &&
                    cat.x + cat.width > monster.x &&
                    cat.y < monster.y + monster.height &&
                    cat.y + cat.height > monster.y) {
                    lives--;
                    monsters.splice(index, 1);
                    if (lives <= 0) {
                        gameOver = true;
                    }
                }

                if (monster.x + monster.width < 0) {
                    monsters.splice(index, 1);
                }
            });

            // วาดไอเทมพิเศษ
            specialItems.forEach((item, index) => {
                item.x -= 2; // ไอเทมเคลื่อนที่เหมือนมอนสเตอร์
                item.draw();

                // ตรวจจับการชนระหว่างแมวและไอเทม
                if (cat.x < item.x + item.width &&
                    cat.x + cat.width > item.x &&
                    cat.y < item.y + item.height &&
                    cat.y + cat.height > item.y) {
                    if (item.type === 'autoShoot') {
                        activateAutoShoot(); // เปิดใช้งานกระสุนอัตโนมัติ
                    } else if (item.type === 'poison') {
                        monsters.forEach(monster => {
                            monster.speed += 1; // เพิ่มความเร็วของมอนสเตอร์ทุกตัว
                        });
                    }
                    specialItems.splice(index, 1); // ลบไอเทมที่เก็บแล้ว
                }

                if (item.x + item.width < 0) {
                    specialItems.splice(index, 1); // ลบไอเทมที่ออกนอกจอ
                }
            });

            // ยิงกระสุนอัตโนมัติ
            if (autoShootActive && Math.random() < 0.1) {
                shoot(); // ยิงกระสุนทุก ๆ ประมาณ 0.1 วินาที
            }

            // แสดงจำนวนชีวิตและมอนสเตอร์ที่ยิงได้
            ctx.fillStyle = 'black';
            ctx.font = '20px Arial';
            ctx.fillText(`Lives: ${'❤️'.repeat(lives)}`, 10, 20);
            ctx.fillText(`Monsters Shot: ${monstersShot}`, 10, 50);

            // ตรวจสอบถ้าเกมจบ
            if (gameOver) {
                ctx.fillStyle = 'red';
                ctx.font = '30px Arial';
                ctx.fillText('Game Over!', canvas.width / 2 - 70, canvas.height / 2);
                ctx.fillText('Click to Restart', canvas.width / 2 - 90, canvas.height / 2 + 40);
                return;
            }
        }

        // ฟังก์ชัน loop ของเกม
        function gameLoop() {
            updateGame();
            requestAnimationFrame(gameLoop);
        }

        // เริ่มต้นเกม
        setInterval(createMonster, 2000); // สร้างมอนสเตอร์ทุก 2 วินาที
        setInterval(createSpecialItem, 5000); // สร้างไอเทมพิเศษทุก 5 วินาที
        canvas.addEventListener('click', () => {
            if (gameOver) {
                location.reload(); // รีโหลดหน้าเว็บเพื่อเริ่มเกมใหม่
            } else {
                shoot(); // ยิงกระสุนเมื่อคลิก
            }
        });

        // เริ่มต้น loop ของเกม
        gameLoop();
    </script>
</body>
</html>
